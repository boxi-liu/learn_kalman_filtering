**协方差**
$COV(X,Y)=\frac{1}{N-1}xy^T-\frac{N}{N-1}u_xu_y$
*$u_x,u_y为x，y的均值$*
物理意义：两个或两个以上随机变量的相关程度的度量
<bar>
**多变量卡尔曼滤波**
*b站的学习足以应对一维卡尔曼滤波，再次不多叙述*
1. 状态外插方程（状态预测器方程）
   ![error](./截图%202025-08-29%2016-40-07.png)

<!-- *笔者现在的学习过程中，更倾向于认为多变量卡尔曼滤波是一种对原五个方程的多维赋值的运用，故而后续多示例为主* -->

*在多变量中，笔者认为其作用就是将描述状态的多个变量用矩阵使其一个式子表达*

示例--对于没有输入的匀加速飞机系统
![error](./截图%202025-08-29%2019-24-08.png)



示例--对于有输入的匀加速飞机系统和自由落体
![error](./截图%202025-08-29%2019-25-55.png)
![error](./截图%202025-08-29%2019-26-02.png)

**状态外插方程推导**
为推出该形式：
$\widehat{x}_{n+1,n}=F\widehat{x}_{n,n}+G\widehat{u}_{n,n}+w_n$
我们需要对系统进行建模，也就是思考出系统的*状态空间表达*:
![error](./截图%202025-08-29%2019-59-43.png)

示例：匀速运动物体

系统没有输入：
$u(t)=0$
状态空间向量：
$x(t)=\begin{bmatrix}
   p\\
   v\\
\end{bmatrix}$

$\dot{x}(t)=Ax(t)+Bu(t)$
![error](./截图%202025-08-29%2020-06-00.png)

？？？？？？

辅助方程补充
![error](./截图%202025-08-29%2020-36-39.png)
![error](./截图%202025-08-29%2020-36-31.png)

<!-- *最终的碎碎念：卡尔曼滤波的重点在于状态方程的建模，剩下的式子皆为机械性的公式套参？？* -->
物理意义汇总：
状态空间向量：

![error](./截图%202025-08-29%2016-40-07.png)
状态转移矩阵：不同时刻状态函数中不同参数需要不同的映射，组合成的矩阵
控制矩阵：与上类似，输入应下一时刻状态函数不同参数需要不同的映射，组合成的矩阵
状态空间向量：
![error](./截图%202025-08-30%2011-05-37.png)
![error](./截图%202025-08-30%2011-07-30.png)
观测矩阵：将状态函数映射到测量向量

![error](./截图%202025-08-30%2011-09-57.png)
![error](./截图%202025-08-30%2011-10-56.png)
简化版：
![error](./截图%202025-08-30%2011-14-12.png)
![error](./截图%202025-08-30%2011-11-27.png)

协方差矩阵代码实现：
```MATLAB
x = [2 3 -1 4];
y = [8 7 9 6];

C = cov(x,y)

C =

    4.6667   -2.6667
   -2.6667    1.6667

```

协方差椭圆代码示例
```MATLAB
C = [5 -2; -2 1];

[eigVec,eigVal] = eig(C);

if eigVal(1,1) >eigVal(2,2)
   a = sqrt(eigVal(1,1));
   b = sqrt(eigVal(2,2));

   theta atan(eigVec(2,1)/eigVec(1,1));
else

   a = sqrt(eigVal(2,2));
   b = sqrt(eigVal(1,1));

   theta = atan(eigVec(2,2)/eigVec(2,1));
```
<br>

**过程模拟**



1. 确定状态量，观测量参数
   $x（t）=\begin{bmatrix}
      x_a(t)\\
      y_a(t)\\
      ...
   \end{bmatrix}$
   $z(t)=\begin{bmatrix}
      x_b(t)\\
      y_b(t)\\
      ...
   \end{bmatrix}$
2. 构建状态方程模型：
   确定各参数与预测估计值的关系，构建映射矩阵。（这里的矩阵起到的是集合作用，将多个式子用一个矩阵的计算式表达，不熟悉推导映射矩阵时，先将状态量，观测量与预测值的关系式一一列出来，回退矩阵即可）
   $ \widehat x_{n,n-1} =F \widehat x_{n-1,n-1} +Gu_{n} +w_n$
3. 确定观测量与状态量的关系：
   $z(t)=Hx(t)+v(t)$
   v(t):随机噪声向量
4. 构建先验协方差方程：
   $\widehat P_{n,n-1} =F*P_{n-1,n-1}*F^T+Q$
5. 修正估计
   $\widehat x_{n,n}=\widehat x_{n,n-1}+K_{n-1}(z_{n}-H\widehat x_{n,n-1})$
6. 更新卡尔曼增益：
   $K_n=\frac{P_{n,n-1}H^T}{HP_{n,n-1}H^T+R}$
7. 更新后验估计协方差
   $P_{n,n}=（I-K_nH）P_{n,n-1}$


每一次迭代的更新输入：
$\widehat{x}_{n-1,n-1},u_n,P_{n-1,n-1},K_{n-1}$
每一次迭代固定的参数：
$F,G,w_n,H,F^T,Q,H^T,R,I$
开始迭代可调节的超参数：
$w_n(过程噪声向量),v(t)（观测噪声）,Q(过程噪声协方差矩阵),R（观测噪声协方差矩阵）$
开始迭代时的初始输入：
x1,u1,P1

*注：u是系统主动施加的控制量，而z是传感器被动采集的状态量*